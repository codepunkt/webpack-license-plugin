<h1 align="center">
  <br>
  <a href="https://github.com/codepunkt/webpack-license-plugin"><img src="https://raw.githubusercontent.com/codepunkt/webpack-license-plugin/master/docs/logo.png" alt="webpack-license-plugin logo" width="200"></a>
  <br>
  webpack-license-plugin
  <br>
</h1>

<h4 align="center">A webpack plugin that helps you with the management of your open source dependencies</h4>

<p align="center">
  <a href="https://badge.fury.io/js/webpack-license-plugin">
    <img src="https://img.shields.io/npm/v/webpack-license-plugin.svg?logo=npm&style=popout"/>
  </a>
  <a href="https://circleci.com/gh/codepunkt/webpack-license-plugin/tree/master">
    <img src="https://img.shields.io/circleci/project/github/codepunkt/webpack-license-plugin/master.svg?style=popout&logo=circleci&logoColor=ddd" alt="CircleCI status"/>
  </a>
  <a href="https://codecov.io/gh/codepunkt/webpack-license-plugin">
    <img src="https://img.shields.io/codecov/c/github/codepunkt/webpack-license-plugin/master.svg?style=popout&logo=codecov" alt="Code coverage"/>
  </a>
  <a href="https://choosealicense.com/licenses/mit/">
    <img src="https://img.shields.io/npm/l/webpack-license-plugin.svg?style=popout&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIzIDMgMjYgMjYiPgogIDxwYXRoIGZpbGw9IiMzZGE2MzkiIGQ9Ik0xNiA1LjU1OWMtNi4xMTggMC0xMS4wNzggNC45Ni0xMS4wNzggMTEuMDc5IDAgNC43NDkgMi45ODkgOC43OTkgNy4xODggMTAuMzc0bDIuNTUzLTYuODA4YTMuODA4IDMuODA4IDAgMSAxIDIuNjc0IDBsMi41NTMgNi44MDhjNC4xOTktMS41NzUgNy4xODgtNS42MjUgNy4xODgtMTAuMzc0IDAtNi4xMTktNC45Ni0xMS4wNzktMTEuMDc5LTExLjA3OXoiLz4KPC9zdmc+Cg==&colorB=lightgray" alt="License: MIT"/>
  </a>
  <a href="https://twitter.com/intent/tweet?text=webpack-license-plugin%20by%20@code_punkt%20extracts%20open%20source%20license%20information%20about%20the%20npm%20packages%20in%20your%20webpack%20output%20and%20helps%20you%20identify%20and%20fix%20problems%20with%20open%20source%20licensing%20https://github.com/codepunkt/webpack-license-plugin%20#webpack%20#oss">
    <img src="https://img.shields.io/badge/tweet-‚á¢-1da1f3.svg?logo=twitter&style=popout" alt="Contact on Twitter"/>
  </a>
</p>

<p align="center">
  <a href="#key-features">Key Features</a> ‚Ä¢
  <a href="#installation">Installation</a> ‚Ä¢
  <a href="#how-to-use">How to use</a> ‚Ä¢
  <a href="#available-options">Available options</a> ‚Ä¢
  <a href="#examples">Examples</a>
</p>

# Key features

> This plugin extracts _open source license information_ about all of the npm packages in your webpack output and helps you identify and fix problems with your open source licensing policy.

This plugin has full test coverage and is tested with **webpack 2.x, 3.x and 4.x**. It will help you:

- üì¶ Discover every npm package used in your webpack output
- üïµÔ∏è Find out how it is licensed
- üìà Summarize the number of packages for each license
- ‚ùå Cancel builds that include unacceptable licenses
- üìÉ Create a customized inventory report or BOM (_bill of materials_) in `json`, `html`, `csv` or other formats


# Installation

Install `webpack-license-plugin` as a development dependency to your current project

#### npm

```bash
npm install -D webpack-license-plugin
```

#### yarn

```bash
yarn add -D webpack-license-plugin
```

# How to use

Use `webpack-license-plugin` in your webpack configuration by adding it to the `plugins` array.

```js
const LicensePlugin = require('webpack-license-plugin')

module.exports = {
  plugins: [
    // there might be other plugins here
    new LicensePlugin()
  ],
}
```

# Available options

Options are given as an `Object` to the first parameter of the `LicensePlugin` constructor:

```js
new LicensePlugin({ outputFilename: 'thirdPartyNotice.json' })
```

The available options are:

|      Name       |                Type                | Description                                                                                                              |
| :------------- | :-------------------------------- | :----------------------------------------------------------------------------------------------------------------------- |
| **`additionalFiles`** | `object` | Default: `{}`. Object that defines additional files that should be generated by this plugin based on it's default output (e.g. an html representation of the licenses in addition to the generated json). Keys represent additional filenames, values are transform methods like the `outputTransform` option. |
| **`licenseOverrides`** | `object` | Default: `{}`. Object with licenses to override. Keys have the format `<name>@<version>`, values are valid [spdx license expressions](https://spdx.org/spdx-specification-21-web-version#h.jxpfx0ykyb60). This can be helpful when license information is inconclusive and has been manually checked. |
| **`outputFilename`** | `string` | Default: `oss-licenses.json`. Path to the output file that will be generated. Relative to the bundle output directory. |
| **`outputTransform`** | `function` | When this option is set, the given function is invoked with a single string parameter: `output`. Transform the `output` string to your desired output and return it so it gets written to `outputFilename`. When you want to add more than a single file to the webpack build output, use the `additionalFiles` option. |
| **`unacceptableLicenseTest`** | `function` | When this option is set, it is invoked for every package with a single string parameter: `license`. It should return true when the license is unacceptable and encountering it should fail the build. |

### Example with custom options

This example has verbose logging output on the terminal, writes the result to a file named `meta/licenses.json` in the output directory, fails whenever it encounters one of the given licenses and overrides the license of the package `fuse.js@3.2.1`.

```js
const LicensePlugin = require('webpack-license-plugin')

module.exports = {
  // ...
  plugins: [
    new LicensePlugin({
      licenseOverrides: {
        // has "Apache" in package.json, but Apache-2.0 text in LICENSE file
        'fuse.js@3.2.1': 'Apache-2.0'
      },
      outputFilename: 'meta/licenses.json',
      unacceptableLicenseTest: (license) => ['GPL', 'AGPL', 'LGPL', 'NGPL'].includes(license),
    }),
  ],
}
```

# Default output

When the `outputTransform` option is not set, the output is a `json` file in the webpack build output directory. It consists of a package list that lists a several license-related details for every npm package that was found to be part of the webpack output:

| | Name | Description |
| :-- | :------------- | :-------------------------------- |
| üÜî | **`name`**  | package name |
| üî¢ | **`version`**  | package version |
| üë© | **`author`** | author listed in `package.json` _(if available)_ |
| üîó | **`repository`** | repository url listed in `package.json` _(if available)_ |
| üì¶ | **`source`** | package tarball url on npm registry |
| üïµÔ∏è | **`license`** | the license listed in `package.json`. If it's not available or not a valid [spdx license expression](https://spdx.org/spdx-specification-21-web-version#h.jxpfx0ykyb60), additional files such as `LICENSE` or `README` are being looked at in order to parse the license data from them. _(this will be shown with a * next to the name of the license and may require further manual verification)_ |
| üìÉ | **`licenseText`** | the license text read from a file matching `/^licen[cs]e/i` in the package's root |

### Example output file
```json
[
  {
    "name": "fbjs",
    "version": "0.8.17",
    "repository": "https://github.com/facebook/fbjs",
    "source": "https://registry.npmjs.org/fbjs/-/fbjs-0.8.17.tgz",
    "license": "MIT",
    "licenseText": "..."
  },
  {
    "name": "object-assign",
    "version": "4.1.1",
    "author": "Sindre Sorhus",
    "repository": "https://github.com/sindresorhus/object-assign",
    "source": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
    "license": "MIT",
    "licenseText": "..."
  },
  {
    "name": "react-dom",
    "version": "16.4.2",
    "repository": "https://github.com/facebook/react",
    "source": "https://registry.npmjs.org/react-dom/-/react-dom-16.4.2.tgz",
    "license": "MIT",
    "licenseText": "..."
  },
  {
    "name": "react",
    "version": "16.4.2",
    "repository": "https://github.com/facebook/react",
    "source": "https://registry.npmjs.org/react/-/react-16.4.2.tgz",
    "license": "MIT",
    "licenseText": "..."
  }
]
```


# Templated output
When the `outputTransform` option is set, the output shown above is passed into that function as a string and the returned value is written to the `outputFilename`.

This way, the output can be formatted to anything you might need.

### Example: Package list as CSV

```js
const LicensePlugin = require('webpack-license-plugin')

const csvTransform = (output) => {
  const keys = ['name', 'version', 'license']
  const packages = JSON.parse(output).packages

  return [
    '"sep=,"',
    keys.join(','),
    ...packages.map(pckg => keys.map(key => `="${pckg[key]}"`).join(',')),
  ].join('\n')
}

module.exports = {
  // ...
  plugins: [
    new LicensePlugin({
      outputFilename: 'oss-licenses.csv',
      outputTransform: csvTransform
    }),
  ],
}
```

# Additional files
When the `additionalFiles` option is set, the output shown above is passed into each files transform method and the returned value is written to the appropriate filename.

### Example: Package list and additional summary

```js
const LicensePlugin = require('webpack-license-plugin')

module.exports = {
  // ...
  plugins: [
    new LicensePlugin({
      additionalFiles: {
        'oss-summary.json': output => {
          return JSON.stringify(
            JSON.parse(output).reduce(
              (prev, { license }) => ({
                ...prev,
                [license]: prev[license] ? prev[license] + 1 : 1,
              }),
              {}
            ),
            null,
            2
          )
        },
      },
    }),
  ],
}
```
